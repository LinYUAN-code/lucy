import{_ as pe,u as ce,a as de,r as y,b as X,c as M,w as ve,d as $,o as s,e as o,f as G,g as S,n as P,h as g,t as v,i as h,F as T,j as C,k,l as Y,m as x,p as Z,v as ee,q as te,E as b,s as V,x as fe,y as _e,z as ge}from"./index-5b4ceb49.js";import{R as ye,m as ae,a as he}from"./RightTips-2a16fb7c.js";import{i as U}from"./index.cjs-5f979497.js";/* empty css                                                                  */const ke=E=>(_e("data-v-c309ef02"),E=E(),ge(),E),Ve={class:"input-container"},Se={class:"input-grammar"},we=ke(()=>S("span",{class:"mode"},"模式选择",-1)),xe={key:0,class:"input-title-none"},be={key:1,class:"input-none"},Re={key:2,class:"input-none"},Te={key:3,class:"input-title-ter"},Ce={key:4,class:"input-ter"},Ie={key:5,class:"input-ter"},Le={class:"input-title"},$e={class:"input-area",style:{"margin-left":"17px"}},Ge=["onClick"],Ee={__name:"InputGrammar",setup(E){const u=ce(),B=de();y(!1);const l=y(u.state.grammarStore.grammar.length?2:1),I=y(),L=y(""),p=y("simple"),j=y(),A=y(),c=X({values:[],inputValue:"",inputVisible:!1}),d=X({values:[],inputValue:"",inputVisible:!1}),N=M(()=>u.getters["grammarStore/getGrammar"]),F=M(()=>u.getters["grammarStore/getNonTerminal"]),K=M(()=>u.getters["grammarStore/getTerminal"]),se=["(",")","[","]","{","}","/","\\",".","*","?","+","^","$"],ne=()=>{l.value++},D=(t,e)=>{t.splice(t.indexOf(e),1)},re=()=>{c.inputVisible=!0,te(()=>{var t,e;(e=(t=j.value)==null?void 0:t.input)==null||e.focus()})},le=()=>{d.inputVisible=!0,te(()=>{var t,e;(e=(t=A.value)==null?void 0:t.input)==null||e.focus()})},z=t=>{t.inputValue.trim()&&t.values.push(t.inputValue),t.inputValue=""},O=t=>{z(t),t.inputVisible=!1},oe=t=>{if(p.value==="simple")try{const{nonTerminals:e,terminals:n}=U.getTockFromSimpleGrammers(t);H(e),J(n)}catch{throw b({message:"存在非法字符，请检查或切换自定义模式",type:"error"}),new Error("Error")}else if(c.values&&H(c.values),d.values){const e=d.values.map(n=>{let r="";for(let i=0;i<n.length;i++){const m=n[i];se.includes(m)?r+=`\\${m}`:r+=m}return[n,new RegExp(`^${r}`)]});J(e)}u.commit("grammarStore/updateGrammar",t),u.commit("grammarStore/updateCustomMode",p.value==="custom"),q.value=!0},H=t=>{u.commit("grammarStore/updateNonTerminal",t)},J=t=>{u.commit("grammarStore/updateTerminal",t)},Q=(t,e)=>{if(!e.length||!t)return"";let n=`${t} =>`;return e.forEach((r,i)=>{r.forEach(m=>{n+=` ${m}`}),i<e.length-1&&(n+=" |")}),n},W=()=>{var e,n;l.value=1;let t="";(n=(e=I.value)==null?void 0:e.textarea)==null||n.focus(),N.value.length&&(N.value.forEach(r=>{t+=r,t+=`
`}),L.value=t,c.values=F.value,d.values=K.value)},q=y(!1),ue=()=>{var f,a,_,R;if(!L.value.trim()){b({message:"请先输入文法",type:"warning"});return}if(p.value==="custom"){if(!c.values.length){b({message:"请输入非终结符",type:"warning"});return}if(!d.values.length){b({message:"请输入终结符",type:"warning"});return}}let t=0,e=[],n=null,r=L.value.split(/\s+/).filter(function(w){return w.length>0}),i=[];for(;t<r.length;)if(t+1<r.length&&r[t+1]==="=>"){const w=Q(n,e);w&&i.push(w),n=r[t],t+=2,e=[[]]}else if(r[t]==="|"){if(!n||!e){b("文法格式错误，请检查"),(a=(f=I.value)==null?void 0:f.textarea)==null||a.focus();return}e.push([]),t+=1}else{if(!n||!e){b("文法格式错误，请检查"),(R=(_=I.value)==null?void 0:_.textarea)==null||R.focus();return}e[e.length-1].push(r[t]),t+=1}const m=Q(n,e);m&&i.push(m),console.log(i),oe(i),ne()},ie=t=>{var f,a;const{route:e,params:n,key:r}=t;if(!e)return;if(l.value<2){b({message:"请先输入文法",type:"warning"}),(a=(f=I.value)==null?void 0:f.textarea)==null||a.focus();return}const i=u.getters["grammarStore/getLRParser"],m=u.getters["grammarStore/getLL1Parser"];if(r==="LL1"&&(q.value||!m)){const _=u.state.grammarStore.terminal,R=new U.LL1Parser(_,F.value,N.value),w=R.getFirstSet(),me=R.getFollowSet(w);u.commit("grammarStore/updateLL1Parser",R),u.commit("grammarStore/updateFirstSet",w),u.commit("grammarStore/updateFollowSet",me)}else if(r==="LR0"&&(q.value||!i)){const _=new U.LRParser;u.commit("grammarStore/updateLRParser",_)}B.push({path:e,query:n})};return ve(()=>B.currentRoute.value.query,()=>{const{step:t}=B.currentRoute.value.query;t==="1"&&W()},{immediate:!0,deep:!0}),(t,e)=>{const n=$("el-radio"),r=$("el-radio-group"),i=$("el-tag"),m=$("el-input"),f=$("el-button");return s(),o("div",Ve,[G(ye,{type:"examples",mode:p.value},null,8,["mode"]),S("div",Se,[S("div",{class:P(["step",{"active-step":l.value===1}])},"Step1 请先完成文法定义：",2),S("div",{class:P(["wrapper",{"wrapper-simple":p.value==="simple"}])},[we,G(r,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),class:"radio"},{default:g(()=>[G(n,{label:"simple"},{default:g(()=>[V(v(x(ae).simple.text),1)]),_:1}),G(n,{label:"custom"},{default:g(()=>[V(v(x(ae).custom.text),1)]),_:1})]),_:1},8,["modelValue"]),p.value==="custom"?(s(),o("span",xe,v(l.value===1?"输入":"")+"非终结符",1)):h("",!0),p.value==="custom"&&l.value===1?(s(),o("div",be,[(s(!0),o(T,null,C(c.values,a=>(s(),k(i,{key:a,closable:"","disable-transitions":!1,size:"large",onClose:_=>D(c.values,a)},{default:g(()=>[V(v(a),1)]),_:2},1032,["onClose"]))),128)),c.inputVisible?(s(),k(m,{key:0,class:"input-none-ter",ref_key:"InputNoneTerRef",ref:j,modelValue:c.inputValue,"onUpdate:modelValue":e[1]||(e[1]=a=>c.inputValue=a),onKeyup:e[2]||(e[2]=Y(a=>z(c),["enter"])),onBlur:e[3]||(e[3]=a=>O(c))},null,8,["modelValue"])):(s(),k(f,{key:1,class:"btn-nonr-ter",onClick:re},{default:g(()=>[V(" 点击新增 ")]),_:1}))])):h("",!0),p.value==="custom"&&l.value===2?(s(),o("div",Re,[(s(!0),o(T,null,C(x(F),a=>(s(),o("span",{key:a},v(a),1))),128))])):h("",!0),p.value==="custom"?(s(),o("span",Te,v(l.value===1?"输入":"")+"终结符",1)):h("",!0),p.value==="custom"&&l.value===1?(s(),o("div",Ce,[(s(!0),o(T,null,C(d.values,a=>(s(),k(i,{key:a,closable:"","disable-transitions":!1,size:"large",onClose:_=>D(d.values,a)},{default:g(()=>[V(v(a),1)]),_:2},1032,["onClose"]))),128)),d.inputVisible?(s(),k(m,{key:0,class:"input-none-ter",ref_key:"InputTerRef",ref:A,modelValue:d.inputValue,"onUpdate:modelValue":e[4]||(e[4]=a=>d.inputValue=a),onKeyup:e[5]||(e[5]=Y(a=>z(d),["enter"])),onBlur:e[6]||(e[6]=a=>O(d))},null,8,["modelValue"])):(s(),k(f,{key:1,class:"btn-nonr-ter",onClick:le},{default:g(()=>[V(" 点击新增 ")]),_:1}))])):h("",!0),p.value==="custom"&&l.value===2?(s(),o("div",Ie,[(s(!0),o(T,null,C(x(K),a=>(s(),o("span",{key:a},v(a),1))),128))])):h("",!0),S("span",Le,v(l.value===1?"输入":"")+"文法",1),Z(G(m,{class:"input-area",type:"textarea",autosize:{minRows:10,maxRows:12},ref_key:"inputRef",ref:I,placeholder:"A => A c | A a d | b d | ε （所有token需要输入空格分割）",modelValue:L.value,"onUpdate:modelValue":e[7]||(e[7]=a=>L.value=a)},null,8,["modelValue"]),[[ee,l.value===1]]),Z(S("ol",$e,[(s(!0),o(T,null,C(x(N),a=>(s(),o("li",{key:a,class:"grammar-li"},v(a),1))),128))],512),[[ee,l.value===2]]),l.value===1?(s(),k(f,{key:6,class:"btn-save",type:"primary",plain:"",onClick:ue},{default:g(()=>[V("输入完成")]),_:1})):h("",!0),l.value===2?(s(),k(f,{key:7,class:"btn-save",icon:x(fe),onClick:W},{default:g(()=>[V("重新定义")]),_:1},8,["icon"])):h("",!0)],2),S("div",{class:P(["step-unfinish",{"active-step":l.value===2}])},"Step2 请选择分析过程：",2),S("div",{class:P(["analysis",{"link-unfinish":l.value<2}])},[(s(!0),o(T,null,C(x(he),a=>(s(),o("a",{onClick:_=>ie(a),key:a.text},v(a.text),9,Ge))),128))],2)])])}}},ze=pe(Ee,[["__scopeId","data-v-c309ef02"]]);export{ze as default};
