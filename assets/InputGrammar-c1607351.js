import{_ as ve,u as fe,a as _e,r as h,b as Z,c as M,w as ge,d as w,o as s,e as r,f as R,g as V,n as B,h as g,t as f,i as k,F as T,j as C,k as b,l as ee,m as L,p as te,v as ae,q as se,E as I,s as y,x as ye,y as he,z as ke}from"./index-9387c24e.js";import{R as Ve,m as le,a as Se,L as G}from"./RightTips-4f346bf7.js";import{i as A}from"./index.cjs-5f979497.js";/* empty css                                                                  */const be=N=>(he("data-v-3dba9a38"),N=N(),ke(),N),xe={class:"input-container"},we={class:"input-grammar"},Re=be(()=>V("span",{class:"mode"},"模式选择",-1)),Te={key:0,class:"input-title-none"},Ce={key:1,class:"input-none"},Le={key:2,class:"input-none"},Ie={key:3,class:"input-title-ter"},$e={key:4,class:"input-ter"},Ee={key:5,class:"input-ter"},Ge={class:"input-title"},Ne={class:"input-area",style:{"margin-left":"17px"}},Pe=["onClick"],Be={key:0,class:"enter-route"},Fe={__name:"InputGrammar",setup(N){const ne=[{value:G[1].route,label:G[1].text},{value:G[2].route,label:G[2].text}],i=fe(),F=_e();h(!1);const o=h(i.state.grammarStore.grammar.length?2:1),$=h(),E=h(""),c=h("simple"),K=h(),D=h(),d=Z({values:[],inputValue:"",inputVisible:!1}),v=Z({values:[],inputValue:"",inputVisible:!1}),z=h(G[1].route),P=M(()=>i.getters["grammarStore/getGrammar"]),U=M(()=>i.getters["grammarStore/getNonTerminal"]),O=M(()=>i.getters["grammarStore/getTerminal"]),re=["(",")","[","]","{","}","/","\\",".","*","?","+","^","$"],oe=()=>{o.value++},H=(t,e)=>{t.splice(t.indexOf(e),1)},ue=()=>{d.inputVisible=!0,se(()=>{var t,e;(e=(t=K.value)==null?void 0:t.input)==null||e.focus()})},ie=()=>{v.inputVisible=!0,se(()=>{var t,e;(e=(t=D.value)==null?void 0:t.input)==null||e.focus()})},j=t=>{t.inputValue.trim()&&t.values.push(t.inputValue),t.inputValue=""},J=t=>{j(t),t.inputVisible=!1},me=t=>{if(c.value==="simple")try{const{nonTerminals:e,terminals:l}=A.getTockFromSimpleGrammers(t);Q(e),W(l)}catch{throw I({message:"存在非法字符，请检查或切换自定义模式",type:"error"}),new Error("Error")}else if(d.values&&Q(d.values),v.values){const e=v.values.map(l=>{let n="";for(let m=0;m<l.length;m++){const p=l[m];re.includes(p)?n+=`\\${p}`:n+=p}return[l,new RegExp(`^${n}`)]});W(e)}i.commit("grammarStore/updateGrammar",t),i.commit("grammarStore/updateCustomMode",c.value==="custom"),q.value=!0},Q=t=>{i.commit("grammarStore/updateNonTerminal",t)},W=t=>{i.commit("grammarStore/updateTerminal",t)},X=(t,e)=>{if(!e.length||!t)return"";let l=`${t} =>`;return e.forEach((n,m)=>{n.forEach(p=>{l+=` ${p}`}),m<e.length-1&&(l+=" |")}),l},Y=()=>{var e,l;o.value=1;let t="";(l=(e=$.value)==null?void 0:e.textarea)==null||l.focus(),P.value.length&&(P.value.forEach(n=>{t+=n,t+=`
`}),E.value=t,d.values=U.value,v.values=O.value)},q=h(!1),pe=()=>{var _,x,S,a;if(!E.value.trim()){I({message:"请先输入文法",type:"warning"});return}if(c.value==="custom"){if(!d.values.length){I({message:"请输入非终结符",type:"warning"});return}if(!v.values.length){I({message:"请输入终结符",type:"warning"});return}}let t=0,e=[],l=null,n=E.value.split(/\s+/).filter(function(u){return u.length>0}),m=[];for(;t<n.length;)if(t+1<n.length&&n[t+1]==="=>"){const u=X(l,e);u&&m.push(u),l=n[t],t+=2,e=[[]]}else if(n[t]==="|"){if(!l||!e){I("文法格式错误，请检查"),(x=(_=$.value)==null?void 0:_.textarea)==null||x.focus();return}e.push([]),t+=1}else{if(!l||!e){I("文法格式错误，请检查"),(a=(S=$.value)==null?void 0:S.textarea)==null||a.focus();return}e[e.length-1].push(n[t]),t+=1}const p=X(l,e);p&&m.push(p),console.log(m),me(m),oe()},ce=t=>{var _,x;const{route:e,params:l,key:n}=t;if(!e)return;if(o.value<2){I({message:"请先输入文法",type:"warning"}),(x=(_=$.value)==null?void 0:_.textarea)==null||x.focus();return}const m=i.getters["grammarStore/getLRParser"],p=i.getters["grammarStore/getLL1Parser"];if(n==="LL1"&&(q.value||!p)){const S=i.state.grammarStore.terminal,a=new A.LL1Parser(S,U.value,P.value),u=a.getFirstSet(),de=a.getFollowSet(u);i.commit("grammarStore/updateLL1Parser",a),i.commit("grammarStore/updateFirstSet",u),i.commit("grammarStore/updateFollowSet",de)}else if(n==="LR0"&&(q.value||!m)){const S=new A.LRParser;i.commit("grammarStore/updateLRParser",S)}F.push({path:n==="LR0"?z.value:e,query:l})};return ge(()=>F.currentRoute.value.query,()=>{const{step:t}=F.currentRoute.value.query;t==="1"&&Y()},{immediate:!0,deep:!0}),(t,e)=>{const l=w("el-radio"),n=w("el-radio-group"),m=w("el-tag"),p=w("el-input"),_=w("el-button"),x=w("el-option"),S=w("el-select");return s(),r("div",xe,[R(Ve,{type:"examples",mode:c.value},null,8,["mode"]),V("div",we,[V("div",{class:B(["step",{"active-step":o.value===1}])},"Step1 请先完成文法定义：",2),V("div",{class:B(["wrapper",{"wrapper-simple":c.value==="simple"}])},[Re,R(n,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),class:"radio"},{default:g(()=>[R(l,{label:"simple"},{default:g(()=>[y(f(L(le).simple.text),1)]),_:1}),R(l,{label:"custom"},{default:g(()=>[y(f(L(le).custom.text),1)]),_:1})]),_:1},8,["modelValue"]),c.value==="custom"?(s(),r("span",Te,f(o.value===1?"输入":"")+"非终结符",1)):k("",!0),c.value==="custom"&&o.value===1?(s(),r("div",Ce,[(s(!0),r(T,null,C(d.values,a=>(s(),b(m,{key:a,closable:"","disable-transitions":!1,size:"large",onClose:u=>H(d.values,a)},{default:g(()=>[y(f(a),1)]),_:2},1032,["onClose"]))),128)),d.inputVisible?(s(),b(p,{key:0,class:"input-none-ter",ref_key:"InputNoneTerRef",ref:K,modelValue:d.inputValue,"onUpdate:modelValue":e[1]||(e[1]=a=>d.inputValue=a),onKeyup:e[2]||(e[2]=ee(a=>j(d),["enter"])),onBlur:e[3]||(e[3]=a=>J(d))},null,8,["modelValue"])):(s(),b(_,{key:1,class:"btn-nonr-ter",onClick:ue},{default:g(()=>[y(" 点击新增 ")]),_:1}))])):k("",!0),c.value==="custom"&&o.value===2?(s(),r("div",Le,[(s(!0),r(T,null,C(L(U),a=>(s(),r("span",{key:a},f(a),1))),128))])):k("",!0),c.value==="custom"?(s(),r("span",Ie,f(o.value===1?"输入":"")+"终结符",1)):k("",!0),c.value==="custom"&&o.value===1?(s(),r("div",$e,[(s(!0),r(T,null,C(v.values,a=>(s(),b(m,{key:a,closable:"","disable-transitions":!1,size:"large",onClose:u=>H(v.values,a)},{default:g(()=>[y(f(a),1)]),_:2},1032,["onClose"]))),128)),v.inputVisible?(s(),b(p,{key:0,class:"input-none-ter",ref_key:"InputTerRef",ref:D,modelValue:v.inputValue,"onUpdate:modelValue":e[4]||(e[4]=a=>v.inputValue=a),onKeyup:e[5]||(e[5]=ee(a=>j(v),["enter"])),onBlur:e[6]||(e[6]=a=>J(v))},null,8,["modelValue"])):(s(),b(_,{key:1,class:"btn-nonr-ter",onClick:ie},{default:g(()=>[y(" 点击新增 ")]),_:1}))])):k("",!0),c.value==="custom"&&o.value===2?(s(),r("div",Ee,[(s(!0),r(T,null,C(L(O),a=>(s(),r("span",{key:a},f(a),1))),128))])):k("",!0),V("span",Ge,f(o.value===1?"输入":"")+"文法",1),te(R(p,{class:"input-area",type:"textarea",autosize:{minRows:10,maxRows:12},ref_key:"inputRef",ref:$,placeholder:"A => A c | A a d | b d | ε （所有token需要输入空格分割）",modelValue:E.value,"onUpdate:modelValue":e[7]||(e[7]=a=>E.value=a)},null,8,["modelValue"]),[[ae,o.value===1]]),te(V("ol",Ne,[(s(!0),r(T,null,C(L(P),a=>(s(),r("li",{key:a,class:"grammar-li"},f(a),1))),128))],512),[[ae,o.value===2]]),o.value===1?(s(),b(_,{key:6,class:"btn-save",type:"primary",plain:"",onClick:pe},{default:g(()=>[y("输入完成")]),_:1})):k("",!0),o.value===2?(s(),b(_,{key:7,class:"btn-save",icon:L(ye),onClick:Y},{default:g(()=>[y("重新定义")]),_:1},8,["icon"])):k("",!0)],2),V("div",{class:B(["step-unfinish",{"active-step":o.value===2}])},"Step2 请选择分析过程：",2),V("div",{class:B(["analysis",{"link-unfinish":o.value<2}])},[(s(!0),r(T,null,C(L(Se),a=>(s(),r("div",{key:a.text},[V("span",{class:"jump",onClick:u=>ce(a)},f(a.text),9,Pe),a.key==="LR0"?(s(),r("span",Be,[y(" （ 跳转至： "),R(S,{modelValue:z.value,"onUpdate:modelValue":e[8]||(e[8]=u=>z.value=u),placeholder:"Select",size:"small"},{default:g(()=>[(s(),r(T,null,C(ne,u=>R(x,{key:u.value,label:u.label,value:u.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue"]),y(" ） ")])):k("",!0)]))),128))],2)])])}}},Me=ve(Fe,[["__scopeId","data-v-3dba9a38"]]);export{Me as default};
